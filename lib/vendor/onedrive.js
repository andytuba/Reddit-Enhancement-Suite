//! Copyright (c) Microsoft Corporation. All rights reserved.
var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);r.prototype=t.prototype,e.prototype=new r};!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.OneDrive=e()}}(function(){return function e(t,r,i){function n(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=r[a]={exports:{}};t[a][0].call(c.exports,function(e){var r=t[a][1][e];return n(r?r:e)},c,c.exports,e,t,r,i)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,t){var r=e("./models/ErrorType"),i=function(){function e(){}return e.ERROR_ACCESS_DENIED="access_denied",e.ERROR_AUTH_REQUIRED="user_authentication_required",e.ERROR_LOGIN_REQUIRED="login_required",e.ERROR_POPUP_OPEN={errorCode:r.popupOpen,message:"popup window is already open"},e.ERROR_WEB_REQUEST={errorCode:r.webRequestFailure,message:"web request failed, see console logs for details"},e.PROTOCOL_HTTP="HTTP",e.PROTOCOL_HTTPS="HTTPS",e.HTTP_GET="GET",e.HTTP_POST="POST",e.HTTP_PUT="PUT",e.LINKTYPE_WEB="webLink",e.LINKTYPE_DOWNLOAD="downloadLink",e.PARAM_ACCESS_TOKEN="access_token",e.PARAM_ERROR="error",e.PARAM_STATE="state",e.PARAM_SDK_STATE="sdk_state",e.PARAM_ID_TOKEN="id_token",e.SDK_VERSION="js-v2.1",e.STATE_AAD_LOGIN="aad_login",e.STATE_AAD_PICKER="aad_picker",e.STATE_MSA_PICKER="msa_picker",e.STATE_OPEN_POPUP="open_popup",e.STATE_GRAPH="graph",e.TYPE_BOOLEAN="boolean",e.TYPE_FUNCTION="function",e.TYPE_OBJECT="object",e.TYPE_STRING="string",e.TYPE_NUMBER="number",e.VROOM_URL="https://api.onedrive.com/v1.0/",e.VROOM_INT_URL="https://newapi.storage.live-int.com/v1.0/",e.GRAPH_URL="https://graph.microsoft.com/v1.0/",e.NONCE_LENGTH=5,e.CUSTOMER_TID="9188040d-6c67-4c5b-b112-36a304b66dad",e.DEFAULT_QUERY_ITEM_PARAMETER="expand=thumbnails&select=id,name,size,webUrl,folder",e.GLOBAL_FUNCTION_PREFIX="oneDriveFilePicker",e.LOGIN_HINT_KEY="odsdkLoginHint",e.LOGIN_HINT_LIFE_SPAN=864e5,e.DOMAIN_HINT_COMMON="common",e.DOMAIN_HINT_AAD="organizations",e.DOMAIN_HINT_MSA="consumers",e}();t.exports=i},{"./models/ErrorType":6}],2:[function(e,t){var r=e("./Constants"),i=e("./OneDriveApp"),n=function(){function e(){}return e.open=function(e){i.open(e)},e.save=function(e){i.save(e)},e.webLink=r.LINKTYPE_WEB,e.downloadLink=r.LINKTYPE_DOWNLOAD,e}();i.onloadInit(),t.exports=n},{"./Constants":1,"./OneDriveApp":3}],3:[function(e,t){var r=e("./utilities/DomUtilities"),i=e("./utilities/ErrorHandler"),n=e("./utilities/Logging"),o=e("./OneDriveState"),a=e("./utilities/Picker"),s=e("./models/PickerMode"),l=e("./utilities/RedirectUtilities"),c=e("./utilities/ResponseParser"),d=e("./utilities/Saver"),u=function(){function e(){}return e.onloadInit=function(){i.registerErrorObserver(o.clearState),r.getScriptInput(),n.logMessage("initialized");var e=l.handleRedirect();if(e){var t=c.parsePickerResponse(e),u=e.windowState.options,p=e.windowState.optionsMode;switch(u.clientId?o.clientId=u.clientId:i.throwError("client id is missing in options"),p){case s[s.open]:var h=new a(u);t.error?h.handlePickerError(t):h.handlePickerSuccess(t);break;case s[s.save]:var f=new d(u);t.error?f.handleSaverError(t):f.handleSaverSuccess(t);break;default:i.throwError("invalid value for options.mode: "+p)}}},e.open=function(e){if(o.readyCheck()){e||i.throwError("missing picker options"),n.logMessage("open started");var t=new a(e);t.launchPicker()}},e.save=function(e){if(o.readyCheck()){e||i.throwError("missing saver options"),n.logMessage("save started");var t=new d(e);t.launchSaver()}},e}();t.exports=u},{"./OneDriveState":4,"./models/PickerMode":9,"./utilities/DomUtilities":15,"./utilities/ErrorHandler":16,"./utilities/Logging":18,"./utilities/Picker":20,"./utilities/RedirectUtilities":22,"./utilities/ResponseParser":23,"./utilities/Saver":24}],4:[function(e,t){var r=e("./Constants"),i=e("./utilities/Logging"),n=function(){function e(){}return e.clearState=function(){window.name="",e._isSdkReady=!0},e.readyCheck=function(){return e._isSdkReady?(e._isSdkReady=!1,!0):!1},e.getODCHost=function(){return(e.debug?"live-int":"live")+".com"},e.getLoginHint=function(t){if(localStorage){var n=JSON.parse(localStorage.getItem(r.LOGIN_HINT_KEY));null!=n&&n[t]&&(e.loginHint=n[t])}else i.logError("the browser does not support local storage")},e.updateLoginHint=function(t){if(localStorage){var n=JSON.parse(localStorage.getItem(r.LOGIN_HINT_KEY));null==n&&(n={}),n[t]=e.loginHint,localStorage.setItem(r.LOGIN_HINT_KEY,JSON.stringify(n))}else i.logError("the browser does not support local storage")},e.deleteLoghinHint=function(e){if(localStorage){var t=JSON.parse(localStorage.getItem(r.LOGIN_HINT_KEY));null!=t&&t[e]&&(delete t[e],localStorage.setItem(r.LOGIN_HINT_KEY,JSON.stringify(t)))}else i.logError("the browser does not support local storage")},e.debug=!1,e._isSdkReady=!0,e}();t.exports=n},{"./Constants":1,"./utilities/Logging":18}],5:[function(e,t){var r;!function(e){e[e.filesV2=0]="filesV2",e[e.graph_odc=1]="graph_odc",e[e.graph_odb=2]="graph_odb",e[e.other=3]="other"}(r||(r={})),t.exports=r},{}],6:[function(e,t){var r;!function(e){e[e.badResponse=0]="badResponse",e[e.fileReaderFailure=1]="fileReaderFailure",e[e.popupOpen=2]="popupOpen",e[e.unknown=3]="unknown",e[e.unsupportedFeature=4]="unsupportedFeature",e[e.webRequestFailure=5]="webRequestFailure"}(r||(r={})),t.exports=r},{}],7:[function(e,t){var r=e("../utilities/CallbackInvoker"),i=e("../Constants"),n=e("../utilities/ErrorHandler"),o=e("../utilities/Logging"),a=e("../OneDriveState"),s=e("../utilities/StringUtilities"),l=e("../utilities/TypeValidators"),c=e("../utilities/UrlUtilities"),d=new RegExp("^[a-fA-F\\d]{8}-([a-fA-F\\d]{4}-){3}[a-fA-F\\d]{12}$"),u=function(){function e(t){this.openInNewWindow=l.validateType(t.openInNewWindow,i.TYPE_BOOLEAN,!0,!0),this.expectGlobalFunction=!this.openInNewWindow,this.expectGlobalFunction&&(this.cancelName=t.cancel,this.errorName=t.error);var n=l.validateCallback(t.cancel,!0,this.expectGlobalFunction);this.cancel=function(){o.logMessage("user cancelled operation"),r.invokeAppCallback(n,!0)};var a=l.validateCallback(t.error,!0,this.expectGlobalFunction);this.error=function(e){o.logError(s.format("error occured - code: '{0}', message: '{1}'",e.errorCode,e.message)),r.invokeAppCallback(a,!0,e)},this.advanced=l.validateType(t.advanced,i.TYPE_OBJECT,!0,{redirectUri:c.trimUrlQuery(window.location.href)}),this.advanced.redirectUri||(this.advanced.redirectUri=c.trimUrlQuery(window.location.href)),this.clientId=l.validateType(t.clientId,i.TYPE_STRING),this.isSharePointRedirect=!!this.advanced.sharePointDoclibUrl,e.checkClientId(this.clientId)}return e.checkClientId=function(e){e?(d.test(e)?o.logMessage("parsed AAD client id: "+e):n.throwError(s.format("invalid format for client id '{0}' - AAD: 32 characters (HEX) GUID",e)),a.clientId=e):n.throwError("client id is missing in options")},e}();t.exports=u},{"../Constants":1,"../OneDriveState":4,"../utilities/CallbackInvoker":14,"../utilities/ErrorHandler":16,"../utilities/Logging":18,"../utilities/StringUtilities":25,"../utilities/TypeValidators":26,"../utilities/UrlUtilities":27}],8:[function(e,t){var r;!function(e){e[e.download=0]="download",e[e.query=1]="query",e[e.share=2]="share"}(r||(r={})),t.exports=r},{}],9:[function(e,t){var r;!function(e){e[e.open=0]="open",e[e.save=1]="save"}(r||(r={})),t.exports=r},{}],10:[function(e,t){var r=e("./PickerActionType"),i=e("../utilities/CallbackInvoker"),n=e("../Constants"),o=e("./InvokerOptions"),a=e("../utilities/Logging"),s=e("./PickerMode"),l=e("../utilities/TypeValidators"),c=function(e){function t(t){e.call(this,t),this.expectGlobalFunction&&(this.successName=t.success);var o=l.validateCallback(t.success,!1,this.expectGlobalFunction);this.success=function(e){a.logMessage("picker operation succeeded"),i.invokeAppCallback(o,!0,e)},this.multiSelect=l.validateType(t.multiSelect,n.TYPE_BOOLEAN,!0,!1);var s=l.validateType(t.action,n.TYPE_STRING);this.action=r[s]}return __extends(t,e),t.prototype.isSharing=function(){return this.action===r.share},t.prototype.serializeState=function(){return{optionsMode:s[s.open],options:{action:r[this.action],advanced:this.advanced,clientId:this.clientId,isSharePointRedirect:this.isSharePointRedirect,success:this.successName,cancel:this.cancelName,error:this.errorName,multiSelect:this.multiSelect,openInNewWindow:this.openInNewWindow}}},t}(o);t.exports=c},{"../Constants":1,"../utilities/CallbackInvoker":14,"../utilities/Logging":18,"../utilities/TypeValidators":26,"./InvokerOptions":7,"./PickerActionType":8,"./PickerMode":9}],11:[function(e,t){var r;!function(e){e[e.save=0]="save",e[e.query=1]="query"}(r||(r={})),t.exports=r},{}],12:[function(e,t){var r=e("../utilities/CallbackInvoker"),i=e("../Constants"),n=e("../utilities/DomUtilities"),o=e("../utilities/ErrorHandler"),a=e("./InvokerOptions"),s=e("../utilities/Logging"),l=e("./PickerMode"),c=e("./SaverActionType"),d=e("../utilities/StringUtilities"),u=e("../utilities/TypeValidators"),p=e("./UploadType"),h=e("../utilities/UrlUtilities"),f=104857600,g="100 MB",_=function(e){function t(t){e.call(this,t),this.invalidFile=!1,this.expectGlobalFunction&&(this.successName=t.success,this.progressName=t.progress);var n=u.validateCallback(t.success,!1,this.expectGlobalFunction);this.success=function(e){s.logMessage("saver operation succeeded"),r.invokeAppCallback(n,!0,e)};var o=u.validateCallback(t.progress,!0,this.expectGlobalFunction);this.progress=function(e){s.logMessage(d.format("upload progress: {0}%",e)),r.invokeAppCallback(o,!1,e)};var a=u.validateType(t.action,i.TYPE_STRING,!0,"query");this.action=c[a],this.action===c.save&&this._setFileInfo(t)}return __extends(t,e),t.prototype.serializeState=function(){return{optionsMode:l[l.save],options:{action:c[this.action],advanced:this.advanced,cancel:this.cancelName,clientId:this.clientId,error:this.errorName,fileName:this.fileName,isSharePointRedirect:this.isSharePointRedirect,openInNewWindow:this.openInNewWindow,progress:this.progressName,sourceInputElementId:this.sourceInputElementId,sourceUri:this.sourceUri,success:this.successName}}},t.prototype._setFileInfo=function(e){e.sourceInputElementId&&e.sourceUri&&o.throwError("Only one type of file to save."),this.sourceInputElementId=e.sourceInputElementId,this.sourceUri=e.sourceUri;var t=u.validateType(e.fileName,i.TYPE_STRING,!0,null);if(this.sourceUri)h.isPathFullUrl(this.sourceUri)?(this.uploadType=p.url,this.fileName=t||h.getFileNameFromUrl(this.sourceUri),this.fileName||o.throwError("must supply a file name or a URL that ends with a file name")):h.isPathDataUrl(this.sourceUri)&&(this.uploadType=p.dataUrl,this.fileName=t,this.fileName||o.throwError("must supply a file name for data URL uploads"));else if(this.sourceInputElementId){this.uploadType=p.form;var r=n.getElementById(this.sourceInputElementId);if(r instanceof HTMLInputElement){if("file"!==r.type&&o.throwError("input elemenet must be of type 'file'"),!r.value)return this.error({errorCode:0,message:"user has not supplied a file to upload"}),void(this.invalidFile=!0);var a=r.files;a&&window.FileReader||o.throwError("browser does not support Files API"),1!==a.length&&o.throwError("can not upload more than one file at a time");var s=a[0];if(s||o.throwError("missing file input"),s.size>f)return this.error({errorCode:1,message:"the user has selected a file larger than "+g}),void(this.invalidFile=!0);this.fileName=t||s.name,this.fileInput=s}else o.throwError("element was not an instance of an HTMLInputElement")}else o.throwError("please specified one type of resource to save")},t}(a);t.exports=_},{"../Constants":1,"../utilities/CallbackInvoker":14,"../utilities/DomUtilities":15,"../utilities/ErrorHandler":16,"../utilities/Logging":18,"../utilities/StringUtilities":25,"../utilities/TypeValidators":26,"../utilities/UrlUtilities":27,"./InvokerOptions":7,"./PickerMode":9,"./SaverActionType":11,"./UploadType":13}],13:[function(e,t){var r;!function(e){e[e.dataUrl=0]="dataUrl",e[e.form=1]="form",e[e.url=2]="url"}(r||(r={})),t.exports=r},{}],14:[function(e,t){var r=e("../Constants"),i=e("../OneDriveState"),n=function(){function e(){}return e.invokeAppCallback=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];t&&i.clearState(),typeof e===r.TYPE_FUNCTION&&e.apply(null,n)},e.invokeCallbackAsynchronous=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];window.setTimeout(function(){e.apply(null,t)},0)},e}();t.exports=n},{"../Constants":1,"../OneDriveState":4}],15:[function(e,t){var r=e("./Logging"),i=e("../OneDriveState"),n="debug",o="enable-logging",a="onedrive-js",s=function(){function e(){}return e.getScriptInput=function(){var t=e.getElementById(a);if(t){var s=t.getAttribute(o);"true"===s&&(r.loggingEnabled=!0);var l=t.getAttribute(n);"true"===l&&(i.debug=!0)}},e.getElementById=function(e){return document.getElementById(e)},e.onDocumentReady=function(e){"interactive"===document.readyState||"complete"===document.readyState?e():document.addEventListener("DOMContentLoaded",e,!1)},e}();t.exports=s},{"../OneDriveState":4,"./Logging":18}],16:[function(e,t){var r=e("./Logging"),i="[OneDriveSDK Error] ",n=function(){function e(){}return e.registerErrorObserver=function(t){e._errorObservers.push(t)},e.throwError=function(t){var n=e._errorObservers;for(var o in n)try{n[o]()}catch(a){r.logError("exception thrown invoking error observer",a)}throw new Error(i+t)},e._errorObservers=[],e}();t.exports=n},{"./Logging":18}],17:[function(e,t){var r=e("../models/ApiEndpoint"),i=e("../Constants"),n=e("./Logging"),o=e("./ObjectUtilities"),a=e("../OneDriveState"),s=e("./UrlUtilities"),l=e("./XHR"),c=e("./StringUtilities"),d=10,u=function(){function e(){}return e.callGraphShareBatch=function(t,r,i,o){var a,s=[],l=0,u=[],p=function(n,o){for(var l=n;o>l;l++){var c=function(e,t){e.permissions=[t],u.push(e),a()},d=function(e){s.push(e.id),a()};e._callGraphShare(t,r[l],i,c,d)}};a=function(){++l===r.length?(s.length&&n.logMessage(c.format("Create sharing link failed for {0} items",s.length)),o(u,s)):l%d===0&&p(l,Math.min(r.length,l+d))},p(0,Math.min(r.length,d))},e.callGraphGetODC=function(t,d,u,p,h){var f=t.apiEndpoint,g=t.accessToken,_=t.itemId,v={Authorization:"bearer "+g};switch(f){case r.graph_odc:break;case r.graph_odb:}var m=s.appendToPath(t.apiEndpointUrl,"drive/items/"+_),E={select:"id,webUrl",expand:"children("+d.replace("&",";")+")"},T=new l({url:s.appendQueryStrings(m,E),clientId:a.clientId,method:i.HTTP_GET,apiEndpoint:f,headers:v});n.logMessage("performing GET on sharing bundle with id: "+_),T.start(function(r){var i=o.deserializeJSON(r.responseText);"share"===t.action?e._callGraphShare(t,i,h,function(e,t){e.webUrl=t.link.webUrl,u(e)},function(){n.logError(c.format("Create link failed for bundle with id {0}:",i.id)),p()}):u(i)},function(){p()})},e.callGraphGetODB=function(e,t,r,u){var p=e.apiEndpointUrl;p+=e.sharePointDriveId?"drives/"+e.sharePointDriveId+"/items":"drive/items/";var h,f=e.apiEndpoint,g=e.accessToken,_=e.itemIds,v={Authorization:"bearer "+g,"Cache-Control":"no-cache, no-store, must-revalidate"},m=[],E=0,T=0,S=_.length,w=function(e,r){n.logMessage(c.format("running batch for items {0} - {1}",e+1,r+1));for(var d=e;r>d;d++){var u=_[d],g=s.appendToPath(p,u+"/?"+t),T=new l({url:g,clientId:a.clientId,method:i.HTTP_GET,apiEndpoint:f,headers:v});n.logMessage("performing GET on item with id: "+u),T.start(function(e){var t=o.deserializeJSON(e.responseText);m.push(t),h()},function(){E++,h()})}};h=function(){++T===S?(m.length&&(n.logMessage(c.format("GET metadata succeeded for '{0}' items",m.length)),r(m)),E&&(n.logMessage(c.format("GET metadata failed for '{0}' items",E)),u(E))):T%d===0&&w(T,Math.min(S,T+d))},w(0,Math.min(S,d))},e._callGraphShare=function(e,t,r,s,d){var u=e.apiEndpointUrl+"drive/items/"+t.id+"/"+e.apiActionNamingSpace+".createLink",p=new l({url:u,clientId:a.clientId,method:i.HTTP_POST,apiEndpoint:e.apiEndpoint,headers:{Authorization:"bearer "+e.accessToken},json:JSON.stringify(r)});p.start(function(e){n.logMessage(c.format("POST createLink succeeded via path {0}",u)),s(t,o.deserializeJSON(e.responseText))},function(){n.logMessage(c.format("POST createLink failed via path {0}",u)),d(t)})},e}();t.exports=u},{"../Constants":1,"../OneDriveState":4,"../models/ApiEndpoint":5,"./Logging":18,"./ObjectUtilities":19,"./StringUtilities":25,"./UrlUtilities":27,"./XHR":29}],18:[function(e,t){var r="onedrive_enable_logging",i="[OneDriveSDK] ",n=function(){function e(){}return e.logError=function(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];e._log(t,!0,r)},e.logMessage=function(t){e._log(t,!1)},e._log=function(t,n){for(var o=[],a=2;a<arguments.length;a++)o[a-2]=arguments[a];(n||e.loggingEnabled||window[r])&&console.log(i+t,o)},e.loggingEnabled=!1,e}();t.exports=n},{}],19:[function(e,t){var r=e("../Constants"),i=e("./Logging"),n=function(){function e(){}return e.shallowClone=function(e){if(typeof e!==r.TYPE_OBJECT||!e)return null;var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},e.deserializeJSON=function(e){var t=null;try{t=JSON.parse(e)}catch(n){i.logError("deserialization error"+n)}return(typeof t!==r.TYPE_OBJECT||null===t)&&(t={}),t},e.serializeJSON=function(e){return JSON.stringify(e)},e}();t.exports=n},{"../Constants":1,"./Logging":18}],20:[function(e,t){var r=e("../Constants"),i=e("./ErrorHandler"),n=e("../models/ErrorType"),o=e("./Logging"),a=e("./ObjectUtilities"),s=e("./Popup"),l=e("../models/PickerOptions"),c=e("./RedirectUtilities"),d=e("./StringUtilities"),u=e("./UrlUtilities"),p=e("./GraphWrapper"),h=e("../models/PickerActionType"),f=function(){function e(e){var t=a.shallowClone(e);this._pickerOptions=new l(t)}return e.prototype.launchPicker=function(){var e=this,t=this._pickerOptions,i=t.serializeState();if(t.openInNewWindow){var n=u.appendQueryStrings(t.advanced.redirectUri,{sdk_state:JSON.stringify(i),state:r.STATE_OPEN_POPUP}),o=new s(n,function(t){e.handlePickerSuccess(t)},function(t){e.handlePickerError(t)});o.openPopup()||t.error(r.ERROR_POPUP_OPEN)}else c.redirectToAADLogin(t,i)},e.prototype.handlePickerSuccess=function(e){var t=e.pickerType,n=this._pickerOptions,o=r.DEFAULT_QUERY_ITEM_PARAMETER;switch(n.action===h.query&&n.advanced.queryParameters?o=n.advanced.queryParameters:n.action===h.download&&(o+=",@content.downloadUrl"),t){case r.STATE_MSA_PICKER:this._handleMSAOpenResponse(e,o);break;case r.STATE_AAD_PICKER:this._handleAADOpenResponse(e,o);break;default:i.throwError("invalid value for picker type: "+t)}},e.prototype.handlePickerError=function(e){e.error===r.ERROR_ACCESS_DENIED?this._pickerOptions.cancel():this._pickerOptions.error({errorCode:n.unknown,message:"something went wrong: "+e.error})},e.prototype._handleMSAOpenResponse=function(e,t){var i,n,o=this,a=this._pickerOptions;a.action===h.share?(i=a.advanced.createLinkParameters||{type:"view"},n=function(t){p.callGraphShareBatch(e,t.children,i,function(e){var r=null;a.action===h.share&&(a.multiSelect?r=t.webUrl:e&&e[0]&&e[0].permissions&&e[0].permissions[0]&&(r=e[0].permissions[0].link.webUrl)),o._handleSuccessResponse({webUrl:r,files:e})})}):n=function(e){o._handleSuccessResponse({webUrl:e.webUrl,files:e.children},!0)},p.callGraphGetODC(e,t,n,function(){a.error(r.ERROR_WEB_REQUEST)},i)},e.prototype._handleAADOpenResponse=function(e,t){var i,n,o=this,a=this._pickerOptions;a.action===h.share?(i=a.advanced.createLinkParameters||{type:"view",scope:"organization"},n=function(t){p.callGraphShareBatch(e,t,i,function(e){o._handleSuccessResponse({webUrl:null,files:e})})}):n=function(e){o._handleSuccessResponse({webUrl:null,files:e},!0)},p.callGraphGetODB(e,t,n,function(){a.error(r.ERROR_WEB_REQUEST)})},e.prototype._handleSuccessResponse=function(e){var t=this._pickerOptions,r={webUrl:t.action===h.share?e.webUrl:null,value:[]},i=e.files;i&&i.length||t.error({errorCode:n.badResponse,message:"no files returned"}),o.logMessage(d.format("returning '{0}' files picked",i.length));for(var a=0;a<i.length;a++){var s=i[a];r.value.push(s)}t.success(r)},e}();t.exports=f},{"../Constants":1,"../models/ErrorType":6,"../models/PickerActionType":8,"../models/PickerOptions":10,"./ErrorHandler":16,"./GraphWrapper":17,"./Logging":18,"./ObjectUtilities":19,"./Popup":21,"./RedirectUtilities":22,"./StringUtilities":25,"./UrlUtilities":27}],21:[function(e,t){var r=e("./CallbackInvoker"),i=e("../Constants"),n=e("./Logging"),o=e("./ResponseParser"),a=800,s=650,l=500,c=function(){function e(e,t,r){this._messageCallbackInvoked=!1,this._url=e,this._successCallback=t,this._failureCallback=r}return e.canReceiveMessage=function(e){return e.origin===window.location.origin},e._createPopupFeatures=function(){var e=window.screenX+Math.max(window.outerWidth-a,0)/2,t=window.screenY+Math.max(window.outerHeight-s,0)/2,r=["width="+a,"height="+s,"top="+t,"left="+e,"status=no","resizable=yes","toolbar=no","menubar=no","scrollbars=yes"];return r.join(",")},e.prototype.openPopup=function(){return e._currentPopup&&e._currentPopup._isPopupOpen()?!1:(window.onedriveReceiveMessage||(window.onedriveReceiveMessage=function(t){var i=e._currentPopup;if(i&&i._isPopupOpen()){e._currentPopup=null;var n=o.parsePickerResponse(t);i._messageCallbackInvoked=!0,void 0===n.error?r.invokeCallbackAsynchronous(i._successCallback,n):r.invokeCallbackAsynchronous(i._failureCallback,n)}}),this._popup=window.open(this._url,"_blank",e._createPopupFeatures()),this._popup.focus(),this._createPopupPinger(),e._currentPopup=this,!0)},e.prototype._createPopupPinger=function(){var t=this,r=window.setInterval(function(){t._isPopupOpen()?t._popup.postMessage("ping","*"):(window.clearInterval(r),e._currentPopup=null,t._messageCallbackInvoked||(n.logMessage("closed callback"),t._failureCallback({error:i.ERROR_ACCESS_DENIED})))},l)},e.prototype._isPopupOpen=function(){return null!==this._popup&&!this._popup.closed},e}();t.exports=c},{"../Constants":1,"./CallbackInvoker":14,"./Logging":18,"./ResponseParser":23}],22:[function(e,t){var r=e("../Constants"),i=e("./DomUtilities"),n=e("./ErrorHandler"),o=e("./Logging"),a=e("./ObjectUtilities"),s=e("../OneDriveState"),l=e("../models/PickerMode"),c=e("./StringUtilities"),d=e("./TypeValidators"),u=e("./UrlUtilities"),p=e("./WindowState"),h=e("./XHR"),f="https://login.microsoftonline.com/{0}/oauth2/v2.0/authorize",g=function(){function e(){}return e.redirect=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=null),t&&p.setWindowState(t,r),u.validateUrlProtocol(e),window.location.replace(e)},e.handleRedirect=function(){var t=u.readCurrentUrlParameters(),i=p.getWindowState(),a=t[r.PARAM_STATE];if(!a)return null;o.logMessage("current state: "+a),a!==r.STATE_OPEN_POPUP||i.options||(i=JSON.parse(t[r.PARAM_SDK_STATE]));var c=i.options,h=i.optionsMode,f=l[h];if(c||n.throwError("missing options from serialized state"),t[r.PARAM_ERROR]===r.ERROR_LOGIN_REQUIRED||t[r.PARAM_ERROR]===r.ERROR_AUTH_REQUIRED)return s.deleteLoghinHint(c.clientId),s.loginHint=null,e.redirectToAADLogin(c,i,!0),null;s.getLoginHint(c.clientId);var g=d.validateType(c.openInNewWindow,r.TYPE_BOOLEAN);switch(g&&e._displayOverlay(),c.advanced&&c.advanced.redirectUri||n.throwError("advanced options is missing"),u.validateRedirectUrlHost(c.advanced.redirectUri),a){case r.STATE_OPEN_POPUP:e.redirectToAADLogin(c,i);break;case r.STATE_AAD_LOGIN:e._handleAADLogin(t,c,f);break;case r.STATE_MSA_PICKER:case r.STATE_AAD_PICKER:var _={windowState:i,queryParameters:t};if(o.logMessage("sending invoker response"),!g)return _;e._sendResponse(_);break;default:n.throwError("invalid value for redirect state: "+a)}return null},e.redirectToAADLogin=function(t,i,n){t.openInNewWindow||e._displayOverlay();var o;return t.isSharePointRedirect?(o=u.appendQueryStrings("https://login.microsoftonline.com/common/oauth2/authorize",{redirect_uri:t.advanced.redirectUri,client_id:t.clientId,response_type:"token",state:r.STATE_AAD_LOGIN,resource:u.getOrigin(t.advanced.sharePointDoclibUrl)}),t.advanced.loginHint&&(o=u.appendQueryString(o,"login_hint",t.advanced.loginHint)),void e.redirect(o,i)):(t.advanced&&t.advanced.loginHint&&(s.loginHint={domainHint:r.DOMAIN_HINT_AAD,loginHint:t.advanced.loginHint,timeStamp:(new Date).getTime()}),o=!n&&s.loginHint&&(new Date).getTime()-r.LOGIN_HINT_LIFE_SPAN<s.loginHint.timeStamp?u.appendQueryStrings(c.format(f,s.loginHint.domainHint),{prompt:"none",domain_hint:s.loginHint.domainHint,login_hint:s.loginHint.loginHint}):c.format(f,r.DOMAIN_HINT_COMMON),o=u.appendQueryStrings(o,{redirect_uri:t.advanced.redirectUri,client_id:t.clientId,scope:"profile openid https://graph.microsoft.com/Files.ReadWrite https://graph.microsoft.com/User.Read",response_mode:"fragment",state:r.STATE_AAD_LOGIN,nonce:u.generateNonce()}),o+="&response_type=id_token+token",void e.redirect(o,i))},e._handleAADLogin=function(t,i,o){if(i.openInNewWindow||e._displayOverlay(),i.advanced.accessToken=t[r.PARAM_ACCESS_TOKEN],i.isSharePointRedirect)return void e._redirectToTenant(i,o,i.openInNewWindow);var a=t[r.PARAM_ID_TOKEN];a||n.throwError("id_toekn is missing in returned parameters");var l=e._parseTenantId(a);l.tid===r.CUSTOMER_TID?(l.preferred_username&&(s.loginHint={loginHint:l.preferred_username,domainHint:r.DOMAIN_HINT_MSA,timeStamp:(new Date).getTime()},s.updateLoginHint(i.clientId)),e._redirectToODCPicker(i,o)):(l.preferred_username&&(s.loginHint={loginHint:l.preferred_username,domainHint:r.DOMAIN_HINT_AAD,timeStamp:(new Date).getTime()},s.updateLoginHint(i.clientId)),e._redirectToTenant(i,o,i.openInNewWindow))},e._redirectToODCPicker=function(t,i){var n,o,a,c;switch(i){case l.open:n="read",o="files",a=t.multiSelect?"multiple":"single";break;case l.save:n="readwrite",o="folders",a="single"}var d="https://login."+s.getODCHost()+"/oauth20_authorize.srf",p=u.appendQueryStrings(d,{client_id:t.clientId,redirect_uri:t.advanced.redirectUri,response_type:"token",scope:"onedrive_onetime.access:"+n+o+"|"+a+"|downloadLink",state:r.STATE_MSA_PICKER});c=t.advanced.filter?t.advanced.filter:"all",e.redirect(p,{options:t,picker:{accessLevel:n,selectionMode:a,viewType:o,filter:c,linkType:"download"}})},e._redirectToTenant=function(t,i,o){var s=function(r){var n,o,a,s;switch(i){case l.open:n="read",o="files",a=t.multiSelect?"multiple":"single";break;case l.save:n="readwrite",o="folders",a="single"}s=t.advanced.filter?t.advanced.filter:"all",e.redirect(r,{picker:{accessLevel:n,selectionMode:a,viewType:o,filter:s},options:t,ODBParams:{p:"2"}})};if(t.isSharePointRedirect){var d=t.advanced.sharePointDoclibUrl;d.indexOf("-my")>-1&&(d+="_layouts/onedrive.aspx"),u.validateUrlProtocol(d,[r.PROTOCOL_HTTPS]),s(d)}else{var p=new h({url:u.appendQueryString(r.GRAPH_URL+"me","$select","mySite"),method:r.HTTP_GET,headers:{Authorization:"bearer "+t.advanced.accessToken,Accept:"application/json"}});p.start(function(e){var t=a.deserializeJSON(e.responseText);t.mySite?s(t.mySite+"_layouts/onedrive.aspx"):n.throwError(c.format("Cannot find the personal tenant url, response text: {0}",e.responseText))},function(t,r){e._handleError(c.format("graph/me request failed, status code: '{0}', response text: '{1}'",h.statusCodeToString(r),t.responseText),o)})}},e._sendResponse=function(t){var r=window.opener;r.onedriveReceiveMessage?r.onedriveReceiveMessage(t):(o.logError("error in window's opener, pop up will close."),e._handleError("SDK message receiver is undefined.",!0)),window.close()},e._handleError=function(t,i){var n={};if(n[r.PARAM_ERROR]=t,i)e._sendResponse({queryParameters:n});else{o.logMessage("error in picker flow, redirecting back to app"),n[r.PARAM_STATE]=r.STATE_AAD_PICKER;var a=u.trimUrlQuery(window.location.href);e.redirect(u.appendQueryStrings(a,n))}},e._parseTenantId=function(e){var t=e.split(".")[1];if(t){var r=t.replace("-","+").replace("_","/");try{var i=JSON.parse(atob(r));return i.tid||n.throwError("tid is missing in parsed open id"),i.preferred_username||n.throwError("preferred_username is missing in parsed open id"),i}catch(o){n.throwError("Base64URL decode and JSON parse of JWT segment failed")}}n.throwError("Received invalid JWT format token")},e._displayOverlay=function(){var e=document.createElement("div"),t=["position: fixed","width: 100%","height: 100%","top: 0px","left: 0px","background-color: white","opacity: 1","z-index: 10000"];e.id="od-overlay",e.style.cssText=t.join(";");var r=document.createElement("img"),n=["position: absolute","top: calc(50% - 40px)","left: calc(50% - 40px)"];r.id="od-spinner",r.src="https://p.sfx.ms/common/spinner_grey_40_transparent.gif",r.style.cssText=n.join(";"),e.appendChild(r);var o=document.createElement("style");o.type="text/css",o.innerHTML="body { visibility: hidden !important; }",document.head.appendChild(o),i.onDocumentReady(function(){var t=document.body;null!==t?t.insertBefore(e,t.firstChild):document.createElement("body").appendChild(e),document.head.removeChild(o)})},e}();t.exports=g},{"../Constants":1,"../OneDriveState":4,"../models/PickerMode":9,"./DomUtilities":15,"./ErrorHandler":16,"./Logging":18,"./ObjectUtilities":19,"./StringUtilities":25,"./TypeValidators":26,"./UrlUtilities":27,"./WindowState":28,"./XHR":29}],23:[function(e,t){var r=e("../models/ApiEndpoint"),i=e("../Constants"),n=e("./ErrorHandler"),o=e("./Logging"),a=e("./UrlUtilities"),s="0000000000000000",l=s.length,c=new RegExp("^\\w+\\.\\w+:\\w+[\\|\\w+]+:([\\w]+\\!\\d+)(?:\\!(.+))*$"),d=function(){function e(){}return e.parsePickerResponse=function(t){o.logMessage("parsing picker response");var r=t.windowState;r||n.throwError("missing windowState from picker response");var a=t.queryParameters;a||n.throwError("missing queryParameters from picker response");var s=a[i.PARAM_ERROR];if(s)return{error:s};var l=a[i.PARAM_STATE],c={pickerType:l,accessToken:r.options.advanced.accessToken};switch(c.action=r.options.action,l){case i.STATE_MSA_PICKER:e._parseMSAResponse(c,a);break;case i.STATE_AAD_PICKER:e._parseAADResponse(c,a,r);break;default:n.throwError("invalid value for picker type: "+l)}return c.accessToken||n.throwError("missing access token"),c.apiEndpointUrl||n.throwError("missing API endpoint URL"),c},e._parseMSAResponse=function(t,o){t.apiEndpoint=r.graph_odc,t.apiEndpointUrl=i.GRAPH_URL,t.apiActionNamingSpace="microsoft.graph";var a=o.scope;a||n.throwError("missing 'scope' paramter from MSA picker response");for(var s,l=a.split(" "),d=0;d<l.length&&!s;d++)s=c.exec(l[d]);s||n.throwError("scope was not formatted correctly");var u=s[1].split("_"),p=u[1],h=p.indexOf("!"),f=p.substring(0,h),g=p.substring(h),_=e._leftPadCid(f),v=_+g;t.ownerCid=_,t.itemId=v,t.authKey=s[2]},e._parseAADResponse=function(e,t,o){o.options.isSharePointRedirect?(e.apiEndpointUrl=a.getOrigin(o.options.advanced.sharePointDoclibUrl)+"_api/v2.0/",e.sharePointDriveId=o.options.advanced.sharePointDriveId,e.apiEndpoint=r.filesV2,e.apiActionNamingSpace="action"):(e.apiEndpoint=r.graph_odb,e.apiEndpointUrl=i.GRAPH_URL+"me/",e.apiActionNamingSpace="microsoft.graph");var s=t["item-id"].split(",");s.length||n.throwError("missing item id(s)"),e.itemIds=s},e._leftPadCid=function(e){return e.length===l?e:s.substring(0,l-e.length)+e},e}();t.exports=d},{"../Constants":1,"../models/ApiEndpoint":5,"./ErrorHandler":16,"./Logging":18,"./UrlUtilities":27}],24:[function(e,t){var r=e("../models/ApiEndpoint"),i=e("./CallbackInvoker"),n=e("../Constants"),o=e("./ErrorHandler"),a=e("../models/ErrorType"),s=e("./GraphWrapper"),l=e("./Logging"),c=e("./ObjectUtilities"),d=e("../OneDriveState"),u=e("./Popup"),p=e("./RedirectUtilities"),h=e("../models/SaverActionType"),f=e("../models/SaverOptions"),g=e("./StringUtilities"),_=e("../models/UploadType"),v=e("./UrlUtilities"),m=e("./XHR"),E=1e3,T=5,S=function(){function e(e){var t=c.shallowClone(e);this._saverOptions=new f(t)
}return e.prototype.launchSaver=function(){var e=this,t=this._saverOptions;if(!t.invalidFile){var r=t.serializeState();if(t.openInNewWindow){var i=v.appendQueryStrings(t.advanced.redirectUri,{sdk_state:JSON.stringify(r),state:n.STATE_OPEN_POPUP}),o=new u(i,function(t){e.handleSaverSuccess(t)},function(t){e.handleSaverError(t)});o.openPopup()||t.error(n.ERROR_POPUP_OPEN)}else p.redirectToAADLogin(t,r)}},e.prototype.handleSaverSuccess=function(e){var t=this,r=e.pickerType,i=n.DEFAULT_QUERY_ITEM_PARAMETER,a=this._saverOptions;switch(a.action===h.query&&a.advanced.queryParameters&&(i=a.advanced.queryParameters),r){case n.STATE_MSA_PICKER:s.callGraphGetODC(e,i,function(r){var i=r.children;i||o.throwError("empty API response");var n=i[0];n&&1===i.length||o.throwError("incorrect number of folders returned"),a.action===h.query?a.success({webUrl:null,value:[n]}):a.action===h.save&&t._executeUpload(e,n)},function(){a.error(n.ERROR_WEB_REQUEST)});break;case n.STATE_AAD_PICKER:var l=e.itemIds;1!==l.length&&o.throwError("incorrect number of folders returned");var c=l[0];c||(c="root"),d.debug&&OneDriveDebug&&(OneDriveDebug.accessToken=e.accessToken),a.action===h.query?s.callGraphGetODB(e,i,function(e){a.success({webUrl:null,value:[e]})},function(){a.error(n.ERROR_WEB_REQUEST)}):this._executeUpload(e,{id:c});break;default:o.throwError("invalid value for picker type: "+r)}},e.prototype.handleSaverError=function(e){e.error===n.ERROR_ACCESS_DENIED?this._saverOptions.cancel():this._saverOptions.error({errorCode:a.unknown,message:"something went wrong: "+e.error})},e.prototype._executeUpload=function(e,t){var r=this._saverOptions.uploadType;l.logMessage(g.format("beginning '{0}' upload",_[r]));var i=e.accessToken;switch(r){case _.dataUrl:case _.url:this._executeUrlUpload(e,t,i,r);break;case _.form:this._executeFormUpload(e,t,i);break;default:o.throwError("invalid value for upload type: "+r)}},e.prototype._executeUrlUpload=function(e,t,r,i){var o=this,s=this._saverOptions;if(i===_.url&&e.pickerType===n.STATE_AAD_PICKER)return void s.error({errorCode:a.unsupportedFeature,message:"URL upload not supported for AAD"});var l=v.appendToPath(e.apiEndpointUrl,"drive/items/"+t.id+"/children"),u={};u.Prefer="respond-async",u.Authorization="bearer "+r;var p={"@microsoft.graph.sourceUrl":s.sourceUri,name:s.fileName,file:{}};p[this._getContentSourceUrl(e.apiEndpoint)]=s.sourceUri;var h=new m({url:l,clientId:d.clientId,method:n.HTTP_POST,headers:u,json:c.serializeJSON(p),apiEndpoint:e.apiEndpoint});h.start(function(e,t){if(i!==_.dataUrl||200!==t&&201!==t)if(i===_.url&&202===t){var l=e.getResponseHeader("Location");l||s.error({errorCode:a.badResponse,message:"missing 'Location' header on response"}),o._beginPolling(l,r)}else s.error(n.ERROR_WEB_REQUEST);else d.debug&&OneDriveDebug&&(OneDriveDebug.itemUrl=c.deserializeJSON(e.responseText)["@odata.id"]),s.success(c.deserializeJSON(e.responseText))},function(){s.error(n.ERROR_WEB_REQUEST)})},e.prototype._executeFormUpload=function(e,t,r){var i=this._saverOptions,s=i.fileInput,c=null;window.File&&s instanceof window.File?c=new FileReader:o.throwError("file reader not supported"),c.onerror=function(e){l.logError("failed to read or upload the file",e),i.error({errorCode:a.fileReaderFailure,message:"failed to read or upload the file, see console log for details"})},c.onload=function(o){var a=v.appendToPath(e.apiEndpointUrl,"drive/items/"+t.id+"/children/"+i.fileName+"/content"),s={};s["@name.conflictBehavior"]=e.pickerType===n.STATE_AAD_PICKER?"fail":"rename";var l={};l.Authorization="bearer "+r,l["Content-Type"]="multipart/form-data";var c=new m({url:v.appendQueryStrings(a,s),clientId:d.clientId,headers:l,apiEndpoint:e.apiEndpoint}),u=o.target.result;c.upload(u,function(e){i.success({webUrl:null,value:[JSON.parse(e.responseText)]})},function(){i.error(n.ERROR_WEB_REQUEST)},function(e,t){i.progress(t.progressPercentage)})},c.readAsArrayBuffer(s)},e.prototype._beginPolling=function(e,t){l.logMessage("polling for URL upload completion");var r=E,o=T,a={url:v.appendQueryString(e,n.PARAM_ACCESS_TOKEN,t),method:n.HTTP_GET},s=this._saverOptions,d=function(){var e=new m(a);e.start(function(e,t){switch(t){case 202:var a=c.deserializeJSON(e.responseText);s.progress(a.percentageComplete),o--||(r*=2,o=T),i.invokeCallbackAsynchronous(d,r);break;case 200:s.progress(100),s.success({webUrl:null,value:[]});break;default:s.error(n.ERROR_WEB_REQUEST)}},function(){s.error(n.ERROR_WEB_REQUEST)})};i.invokeCallbackAsynchronous(d,r)},e.prototype._getContentSourceUrl=function(e){return e===r.graph_odb||r.graph_odc?"@microsoft.graph.sourceUrl":"@content.sourceUrl"},e}();t.exports=S},{"../Constants":1,"../OneDriveState":4,"../models/ApiEndpoint":5,"../models/ErrorType":6,"../models/SaverActionType":11,"../models/SaverOptions":12,"../models/UploadType":13,"./CallbackInvoker":14,"./ErrorHandler":16,"./GraphWrapper":17,"./Logging":18,"./ObjectUtilities":19,"./Popup":21,"./RedirectUtilities":22,"./StringUtilities":25,"./UrlUtilities":27,"./XHR":29}],25:[function(e,t){var r=/[\{\}]/g,i=/\{\d+\}/g,n=function(){function e(){}return e.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=function(e){var i=t[e.replace(r,"")];return null===i&&(i=""),i};return e.replace(i,o)},e}();t.exports=n},{}],26:[function(e,t){var r=e("../Constants"),i=e("./ErrorHandler"),n=e("./Logging"),o=e("./ObjectUtilities"),a=e("./StringUtilities"),s=function(){function e(){}return e.validateType=function(t,r,s,l,c){if(void 0===s&&(s=!1),void 0===t){if(s)return void 0===l&&i.throwError("default value missing"),n.logMessage("applying default value: "+l),l;i.throwError("object was missing and not optional")}var d=typeof t;return d!==r&&i.throwError(a.format("expected object type: '{0}', actual object type: '{1}'",r,d)),e._isValidValue(t,c)||i.throwError(a.format("object does not match any valid values: '{0}'",o.serializeJSON(c))),t},e.validateCallback=function(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===e){if(t)return null;i.throwError("function was missing and not optional")}var o=typeof e;o!==r.TYPE_STRING&&o!==r.TYPE_FUNCTION&&i.throwError(a.format("expected function type: 'function | string', actual type: '{0}'",o));var s=null;if(o===r.TYPE_STRING){var l=window[e];typeof l===r.TYPE_FUNCTION?s=l:i.throwError(a.format("could not find a function with name '{0}' on the window object",e))}else n?i.throwError("expected a global function"):s=e;return s},e._isValidValue=function(e,t){if(!Array.isArray(t))return!0;for(var r in t)if(e===t[r])return!0;return!1},e}();t.exports=s},{"../Constants":1,"./ErrorHandler":16,"./Logging":18,"./ObjectUtilities":19,"./StringUtilities":25}],27:[function(e,t){var r=e("../Constants"),i=e("./ErrorHandler"),n=e("./StringUtilities"),o=function(){function e(){}return e.appendToPath=function(e,t){return e+("/"!==e.charAt(e.length-1)?"/":"")+t},e.appendQueryString=function(t,r,i){return e.appendQueryStrings(t,(n={},n[r]=i,n));var n},e.appendQueryStrings=function(e,t,r){if(!t||0===Object.keys(t).length)return e;r?e+="#":-1===e.indexOf("?")?e+="?":"&"!==e.charAt(e.length-1)&&(e+="&");var i="";for(var o in t)i+=(i.length?"&":"")+n.format("{0}={1}",encodeURIComponent(o),encodeURIComponent(t[o]));return e+i},e.readCurrentUrlParameters=function(){return e.readUrlParameters(window.location.href)},e.readUrlParameters=function(t){var r={},i=t.indexOf("?")+1,n=t.indexOf("#")+1;if(i>0){var o=n>i?n-1:t.length;e._deserializeParameters(t.substring(i,o),r)}return n>0&&e._deserializeParameters(t.substring(n),r),r},e.trimUrlQuery=function(e){var t=["?","#"];for(var r in t){var i=e.indexOf(t[r]);i>0&&(e=e.substring(0,i))}return e},e.getFileNameFromUrl=function(t){var r=e.trimUrlQuery(t);return r.substr(r.lastIndexOf("/")+1)},e.getOrigin=function(t){return e.appendToPath(t.replace(/^((\w+:)?\/\/[^\/]+\/?).*$/,"$1"),"")},e.isPathFullUrl=function(e){return 0===e.indexOf("https://")||0===e.indexOf("http://")},e.isPathDataUrl=function(e){return 0===e.indexOf("data:")},e.generateNonce=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<r.NONCE_LENGTH;i++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},e.validateUrlProtocol=function(e,t){t=t?t:[r.PROTOCOL_HTTP,r.PROTOCOL_HTTPS];for(var n=0;n<t.length;n++){var o=t[n];if(0===e.toUpperCase().indexOf(o))return}i.throwError("redirect uri does not match any protocol in "+t)},e.validateRedirectUrlHost=function(t){if(e.validateUrlProtocol(t),t.indexOf("://")>-1){var r=t.split("/")[2];r!==window.location.host&&i.throwError("redirect uri is not in the same domain as picker sdk")}else i.throwError("redirect uri is not an absolute url")},e._deserializeParameters=function(e,t){for(var r=e.split("&"),i=0;i<r.length;i++){var n=r[i].split("=");2===n.length&&(t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]))}},e}();t.exports=o},{"../Constants":1,"./ErrorHandler":16,"./StringUtilities":25}],28:[function(e,t){var r=e("./Logging"),i=e("./ObjectUtilities"),n=function(){function e(){}return e.getWindowState=function(){return i.deserializeJSON(window.name||"{}")},e.setWindowState=function(t,n){void 0===n&&(n=null),null===n&&(n=e.getWindowState());for(var o in t)n[o]=t[o];var a=i.serializeJSON(n);r.logMessage("window.name = "+a),window.name=a},e}();t.exports=n},{"./Logging":18,"./ObjectUtilities":19}],29:[function(e,t){var r=e("../models/ApiEndpoint"),i=e("../Constants"),n=e("./ErrorHandler"),o=e("./Logging"),a=e("./StringUtilities"),s=3e4,l=-1,c=-2,d=-3,u=function(){function e(e){this._url=e.url,this._json=e.json,this._headers=e.headers||{},this._method=e.method,this._clientId=e.clientId,this._apiEndpoint=e.apiEndpoint||r.other,n.registerErrorObserver(this._abortRequest)}return e.statusCodeToString=function(e){switch(e){case-1:return"EXCEPTION";case-2:return"TIMEOUT";case-3:return"REQUEST ABORTED";default:return e.toString()}},e.prototype.start=function(e,t){var r=this;try{this._successCallback=e,this._failureCallback=t,this._request=new XMLHttpRequest,this._request.ontimeout=this._onTimeout,this._request.onreadystatechange=function(){if(!r._completed&&4===r._request.readyState){r._completed=!0;var e=r._request.status;400>e&&e>0?r._callSuccessCallback(e):r._callFailureCallback(e)}},this._method||(this._method=this._json?i.HTTP_POST:i.HTTP_GET),this._request.open(this._method,this._url,!0),this._request.timeout=s,this._setHeaders(),o.logMessage("starting request to: "+this._url),this._request.send(this._json)}catch(n){this._callFailureCallback(l,n)}},e.prototype.upload=function(e,t,r,n){var a=this;try{this._successCallback=t,this._progressCallback=n,this._failureCallback=r,this._request=new XMLHttpRequest,this._request.ontimeout=this._onTimeout,this._method=i.HTTP_PUT,this._request.open(this._method,this._url,!0),this._setHeaders(),this._request.onload=function(e){a._completed=!0;var t=a._request.status;200===t||201===t?a._callSuccessCallback(t):a._callFailureCallback(t,e)},this._request.onerror=function(e){a._completed=!0,a._callFailureCallback(a._request.status,e)},this._request.upload.onprogress=function(e){if(e.lengthComputable){var t={bytesTransferred:e.loaded,totalBytes:e.total,progressPercentage:0===e.total?0:e.loaded/e.total*100};a._callProgressCallback(t)}},o.logMessage("starting upload to: "+this._url),this._request.send(e)}catch(s){this._callFailureCallback(l,s)}},e.prototype._callSuccessCallback=function(t){o.logMessage("calling xhr success callback, status: "+e.statusCodeToString(t)),this._successCallback(this._request,t,this._url)},e.prototype._callFailureCallback=function(t,r){o.logError("calling xhr failure callback, status: "+e.statusCodeToString(t),this._request,r),this._failureCallback(this._request,t,t===c)},e.prototype._callProgressCallback=function(e){o.logMessage("calling xhr upload progress callback"),this._progressCallback(this._request,e)},e.prototype._abortRequest=function(){if(!this._completed){if(this._completed=!0,this._request)try{this._request.abort()}catch(e){}this._callFailureCallback(d)}},e.prototype._onTimeout=function(){this._completed||(this._completed=!0,this._callFailureCallback(c))},e.prototype._setHeaders=function(){for(var e in this._headers)this._request.setRequestHeader(e,this._headers[e]);this._clientId&&this._apiEndpoint!==r.other&&this._request.setRequestHeader("Application","0x"+this._clientId);var t=a.format("{0}={1}","SDK-Version",i.SDK_VERSION);switch(this._apiEndpoint){case r.graph_odb:this._request.setRequestHeader("X-ClientService-ClientTag",t);break;case r.graph_odc:this._request.setRequestHeader("X-RequestStats",t);break;case r.other:break;default:n.throwError("invalid API endpoint: "+this._apiEndpoint)}this._method===i.HTTP_POST&&this._request.setRequestHeader("Content-Type",this._json?"application/json":"text/plain")},e}();t.exports=u},{"../Constants":1,"../models/ApiEndpoint":5,"./ErrorHandler":16,"./Logging":18,"./StringUtilities":25}]},{},[2])(2)});